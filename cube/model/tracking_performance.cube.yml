cubes:
  - name: tracking_performance_today
    title: Tracking Performance Today
    description: First party tracking data for today
    sql: |
      SELECT *
      FROM { COMPILE_CONTEXT.securityContext.dataset }.eyk_tracking_events_flattened
      WHERE timestamp > UNIX_MILLIS(TIMESTAMP(CURRENT_DATE()))

    dimensions:

      - name: timestamp_hourly
        title: Timestamp hourly
        description: The timestamp of the event truncated to hourly intervals
        sql: TIMESTAMP_TRUNC(event_timestamp, HOUR)
        type: time

      - name: is_bot
        title: Is generated by a bot
        description: Whether the event was generated by a bot
        sql: stape_bot
        type: boolean

    measures:

      - name: events
        title: Events
        description: The number of events
        type: number
        sql: COUNT(*)
        format: number

      - name: visitors
        title: Visitors
        description: The number of visitors
        type: number
        sql: COUNT(DISTINCT user_id)
        format: number

      - name: purchase_events
        title: Purchase events
        description: The number of purchase events
        type: number
        sql: COUNTIF(CONTAINS_SUBSTR(event_name, 'purchase'))
        format: number

    pre_aggregations:

  - name: tracking_performance_descriptives
    title: Tracking Performance Descriptives
    description: First party tracking data descriptive data
    sql: |
      SELECT *
      FROM { COMPILE_CONTEXT.securityContext.dataset }.tracking_performance_descriptives

    dimensions:

      - name: date
        title: Date
        description: The date of the results
        sql: TIMESTAMP(date)
        type: time

      - name: is_bot
        title: Bot traffic
        description: Whether the event was generated by a bot
        sql: stape_bot
        type: boolean

      - name: latitude
        title: Latitude
        description: The latitude of the event
        sql: latitude
        type: string

      - name: longitude
        title: Longitude
        description: The longitude of the event
        sql: longitude
        type: string

      - name: country
        title: Country
        description: The country of the event
        sql: country
        type: string

      - name: region
        title: Region
        description: The region of the event
        sql: region
        type: string

      - name: device_mobile
        title: Device Mobile
        description: Whether the device is a mobile device
        sql: device_mobile
        type: boolean

      - name: device_browser
        title: Device Browser
        description: The browser of the device
        sql: device_browser
        type: string

      - name: device_os
        title: Device OS
        description: The operating system of the device
        sql: device_os
        type: string

      - name: combined_source
        title: Combined Source
        description: The source of the event
        sql: combined_source
        type: string

      - name: combined_medium
        title: Combined Medium
        description: The medium of the event
        sql: combined_medium
        type: string

      - name: combined_campaign
        title: Combined Campaign
        description: The campaign of the event
        sql: combined_campaign
        type: string

      - name: combined_term
        title: Combined Term
        description: The term of the event
        sql: combined_term
        type: string

      - name: combined_content
        title: Combined Content
        description: The content of the event
        sql: combined_content
        type: string

      - name: combined_id
        title: Combined ID
        description: The ID of the event
        sql: combined_id
        type: string

    measures:

      - name: sessions
        title: The number of sessions
        type: sum
        sql: sessions
        format: number

      - name: visitors
        title: The number of visitors
        type: sum
        sql: visitors
        format: number

      - name: customers
        title: The number of customers
        type: sum
        sql: customers
        format: number

      - name: purchases
        title: The number of purchases
        type: sum
        sql: purchases
        format: number

      - name: subscriptions
        title: The number of subscriptions
        type: sum
        sql: subscriptions
        format: number

    pre_aggregations:
